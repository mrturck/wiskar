<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wiskar Platform</title>
    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/bootstrap/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/css/Navigation-Clean.css">
    <link rel="stylesheet" href="assets/css/Navigation-with-Button-1.css">
    <link rel="stylesheet" href="assets/css/Navigation-with-Button.css">
    <link rel="stylesheet" href="assets/css/Navigation-with-Search.css">
    <link rel="stylesheet" href="assets/css/studio-style.css">
    <link rel="stylesheet" href="assets/css/styles.css">
    <link rel="stylesheet" href="assets/css/wiskar.css">
    <script src="https://aframe.io/releases/0.7.0/aframe.min.js"></script>
    <!-- <script src="../build/aframe-ar.js"></script> -->
    <script src="assets/js/effect.js"></script>
    <script src="assets/js/joystick.js"></script>
    <script src="../platform/prototype.js"></script>
</head>

<script>
 var tap = 0;
 var point;
  // cursor listener
  AFRAME.registerComponent('cursor-listener', {
    init: function () {
      this.el.addEventListener('mouseenter', function (evt) {
        this.setAttribute('color','#ff0000');
        this.setAttribute('material','opacity:.85');
          point = getNewPos(evt);
      });
      this.el.addEventListener('mouseleave', function (evt) {
        this.setAttribute('color','rgb(' + getRandom() + ", " + (getRandom() + 150) + ", " +  (getRandom() + 60)+")");
        this.setAttribute('material','opacity:1');
      });
    }
  });

   // generate working plane
   AFRAME.registerComponent('build-plane', {
    schema: {
      size: {type: 'number', default: 20},
        },
    init: function() {
          i = 0; j = 0; count = 0; size = this.data.size; maxCount = size * size -1;
        },
    tick: function (time, timeDelta) {
      for (l=0;l<10;l++) {
        if (count < maxCount) {
          if (j<size+1) {
         createPlaneBox(i,j,size);
         j++;
         count++;
       }
        else {
          i++;
          j=0;

        }
       }
     }
       }
   });

  function createPlaneBox(i,j,size) {
      s = document.querySelector("a-scene");
      b = document.createElement("a-box");
      b.setAttribute('scale','1 .1 1');
      b.setAttribute('cursor-listener','true')
      b.setAttribute('color','#b5d9fe')
      b.setAttribute('position',(i-size/2) + " -.1 " + (j-(size)));
      c = document.createElement("a-animation");
      c.setAttribute("attribute","material.color")
      c.setAttribute("from","#b5d9fe")
      c.setAttribute("to",'rgb(' + getRandom() + ", " + (getRandom() + 150) + ", " +  (getRandom() + 60)+")")
      c.setAttribute("dur","2000")
      b.appendChild(c);
      s.appendChild(b);
      }

  function getRandom() {
    return Math.floor(Math.random()*20)
  }

  function createBox(point) {
    scene = document.querySelector("a-scene");
    el = document.createElement("a-entity");
    el.setAttribute('obj-model',"obj: #tree-obj; mtl: #tree-mtl")
    el.setAttribute('position',point)
    t = getRandom()*.0003;
    console.log(t);
    el.setAttribute('scale','.01 '+ (.01-t) + ' .01')
    el.setAttribute('rotation','0 '+getRandom()*90+ " 0")
    c = document.createElement("a-animation");
    c.setAttribute("attribute","position")
    c.setAttribute("from","0 100 0")
    c.setAttribute("to",point)
    c.setAttribute("dur","1000")
    el.appendChild(c);
    scene.appendChild(el);


  }

  function getNewPos(evt) {
    norm = evt.detail.intersection.face.normal;
    position = evt.detail.intersection.object.parent.position;

    x = (1*norm["x"] + 1*position["x"]).toString();
    y = (1*norm["y"] + 1*position["y"]-1).toString();
    z = (1*norm["z"] + 1*position["z"]).toString();

    p = x + " " + y + " " + z

    return p;
  }

</script>

<body class="ar">
  <!-- ar-scene -->
  <a-scene build-plane joystick vr-mode-ui="enabled: false"  >
    <!-- <a-entity light="type:point; color:#7000ff" position="5.6 7.5 -3.6"></a-entity>
    <a-entity light="type:point; color:#ffcc5b" position="-5 7.5 -10.7"></a-entity>
    <a-entity light="type:point; color:#00ffc2" position="8 7.5 -12.7"></a-entity> -->

      <!-- load assets -->
      <a-assets>
        <a-asset-item id="tree-obj" src="../obj/tree-model/tree01.obj"></a-asset-item>
        <a-asset-item id="tree-mtl" src="../obj/tree-model/tree01.mtl"></a-asset-item>
      </a-assets>
      <a-assets>
        <a-asset-item id="house-obj" src="../obj/house/house.obj"></a-asset-item>
        <a-asset-item id="house-mtl" src="../obj/house/house.mtl"></a-asset-item>
      </a-assets>
      <a-assets>
        <a-asset-item id="flower-obj" src="../obj/flower/flower.obj"></a-asset-item>
        <a-asset-item id="flower-mtl" src="../obj/flower/flower.mtl"></a-asset-item>
      </a-assets>

      <a-entity camera id="camera" position="0 5 3" look-controls wasd-controls>
          <a-cursor position="0 0 -1"></a-cursor>
      </a-entity>

</a-scene>

    <!-- html -->
    <div >
        <nav class="navbar navbar-light navbar-expand-md navigation-clean-button">
            <div class="container"><a class="navbar-brand" href="#">wiskar.io</a><button class="navbar-toggler" data-toggle="collapse" data-target="#navcol-1"><span class="sr-only">Toggle navigation</span><span class="navbar-toggler-icon"></span></button>
                <div class="collapse navbar-collapse"
                    id="navcol-1">
                    <ul class="nav navbar-nav mr-auto"></ul><span class="navbar-text actions"> <a href="#" class="login">Log In</a><a class="btn btn-light action-button" role="button" href="#">Sign Up</a></span></div>
            </div>
        </nav>
    </div>
    <button class="btn btn-primary tool" type="button" id="picker">+</button>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.8/hammer.min.js"></script>
    <script src="assets/js/studio.js"></script>
</body>


</html>
